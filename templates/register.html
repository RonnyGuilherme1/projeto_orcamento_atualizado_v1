{% extends "base_public.html" %}
{% set page_class = 'page-register' %}
{% set page_css = ['/static/css/register.css'] %}
{% from 'components/ui.html' import btn, input_text %}

{% block title %}Criar conta | {{ APP_NAME }}{% endblock %}

{% block headline %}Criar conta{% endblock %}

{% block subhead %}
  {% set p = (selected_plan or 'basic') %}
  {% set label_map = {'basic': 'Basic', 'plus': 'Plus', 'pro': 'Pro'} %}
  {% set plan_label = label_map.get(p, 'Basic') %}
  <p class="public-subtitle">
    Plano selecionado:
    <strong id="selected-plan-badge" class="plan-badge plan-{{ p }}">{{ plan_label }}</strong>.
    Pagamento e upgrade acontecem dentro do app após cadastro (com e-mail verificado).
  </p>
{% endblock %}


{% block content %}
  <form class="public-form" method="post" action="/register">
    <input type="hidden" name="checkout_token" value="{{ checkout_token or '' }}">
    <input type="hidden" name="plan" id="selected-plan-input" value="{{ (selected_plan or 'basic')|lower }}">

    <div class="register-grid">
      <div class="register-left">
        <div class="plan-picker">
          <p class="plan-picker-title">Escolha seu plano</p>
          <div class="plans-grid" id="plans-grid" aria-label="Planos disponíveis"></div>
        </div>
      </div>

      <div class="register-right">
        {{ input_text('username', 'username', 'Usuário', autocomplete='username', required=true) }}
        {{ input_text('email', 'email', 'E-mail', type='email', autocomplete='email', required=true) }}
        {{ input_text('full_name', 'full_name', 'Nome completo', autocomplete='name', required=true) }}
        {{ input_text('tax_id', 'tax_id', 'CPF', placeholder='000.000.000-00', required=true, attrs={'data-mask': 'cpf', 'inputmode': 'numeric', 'maxlength': '14'}) }}
        {{ input_text('cellphone', 'cellphone', 'Telefone', placeholder='(00) 00000-0000', autocomplete='tel', required=true, attrs={'data-mask': 'phone', 'inputmode': 'numeric', 'maxlength': '15'}) }}
        {{ input_text('password', 'password', 'Senha', type='password', autocomplete='new-password', required=true) }}
        {{ input_text('confirm_password', 'confirm_password', 'Confirmar senha', type='password', autocomplete='new-password', required=true) }}

        {{ btn('Criar conta', 'primary', type='submit') }}
      </div>
    </div>
  </form>

  <p class="public-footer-links">
    Já tem conta? <a href="/login{% if checkout_token %}?token={{ checkout_token }}{% endif %}">Entrar</a>
  </p>

  <script>
    const PLANS = {{ PLANS | tojson }};
    const DEFAULT_PLAN = {{ (selected_plan or 'basic') | tojson }};
  </script>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/register.js"></script>
  <script src="/static/js/document_masks.js"></script>
{% endblock %}
