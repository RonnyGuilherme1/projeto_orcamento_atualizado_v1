{% extends "base_app.html" %}
{% set page_class = 'page-entries' %}
{% set page_css = ['/static/css/entries.css'] %}

{% block title %}Entradas{% endblock %}

{% block page_title %}Entradas{% endblock %}

{% block content %}
  <div class="page entries-page">
    <div class="entries-top-grid">
      <!-- NOVA ENTRADA -->
      <section class="panel entry-panel">
        <div class="panel-head compact">
          <div>
            <h2 class="panel-title">Nova Entrada</h2>
            <p class="panel-subtitle">Cadastre receitas e despesas. Para despesas, defina o status.</p>
          </div>
        </div>

        <form id="form" class="entry-form is-compact">
          <div class="form-grid">
            <label class="field field-date field-compact">
              <span class="field-label">Data</span>
              <input type="date" id="data" class="control" required>
            </label>

            <label class="field field-tipo field-compact">
              <span class="field-label">Tipo</span>
              <select id="tipo" class="control" required>
                <option value="receita">Receita</option>
                <option value="despesa">Despesa</option>
              </select>
            </label>

            <label class="field field-categoria field-compact">
              <span class="field-label">Categoria</span>
              <select id="categoria" class="control">
                <option value="salario">Sal?rio</option>
                <option value="extras">Extras</option>
                <option value="moradia">Moradia</option>
                <option value="mercado">Mercado</option>
                <option value="transporte">Transporte</option>
                <option value="servicos">Servi?os</option>
                <option value="outros" selected>Outros</option>
              </select>
            </label>

            {% if has_feature('filters') %}
            <label class="field field-metodo field-expanded">
              <span class="field-label">Método</span>
              <select id="metodo" class="control">
                <option value="">Não informado</option>
                <option value="dinheiro">Dinheiro</option>
                <option value="cartao">Cartão</option>
                <option value="pix">Pix</option>
              </select>
            </label>
            {% endif %}

            <label class="field field-status field-expanded">
              <span class="field-label">Status</span>
              <select id="status" class="control">
                <option value="em_andamento">Em andamento</option>
                <option value="pago">Pago</option>
                <option value="nao_pago">N?o pago</option>
              </select>
            </label>

            <label class="field field-descricao span-2 field-expanded">
              <span class="field-label">Descri??o</span>
              <input type="text" id="descricao" class="control" placeholder="Ex: Sal?rio, Mercado, Internet..." required>
            </label>

            <label class="field field-valor field-compact">
              <span class="field-label">Valor</span>
              <input type="number" step="0.01" id="valor" class="control" placeholder="0,00" required>
            </label>

            <div class="form-actions form-actions-compact">
              <button type="button" class="btn-primary btn-compact" id="entry-expand" aria-label="Expandir formul?rio">+</button>
            </div>

            <div class="form-actions form-actions-expanded span-all field-expanded">
              <button type="submit" class="btn-primary btn-wide">Adicionar</button>
            </div>
          </div>
        </form>
      </section>

    </div>

    <section class="history-grid">
      <div class="panel panel-historico panel-receitas">
        <div class="panel-head compact row">
          <h2 class="panel-title">Receitas</h2>
          <div class="panel-actions">
            <label class="field field-inline">
              <span class="field-label">Trimestre</span>
              <select id="filtro-trimestre-receitas" class="control" aria-label="Filtrar receitas por trimestre">
                <option value="all">Todos</option>
                <option value="1">1º Trimestre</option>
                <option value="2">2º Trimestre</option>
                <option value="3">3º Trimestre</option>
                <option value="4">4º Trimestre</option>
              </select>
            </label>
          </div>
        </div>

        <div class="history-toolbar">
          <span class="toolbar-label">Filtros:</span>
          <div class="toolbar-search">
            <input type="text" id="receita-filter-search" class="control" placeholder="Titulo">
          </div>
          <div class="toolbar-actions">
            <div class="filter-dropdown">
              <button class="btn-tertiary filter-menu-btn" type="button" data-filter-menu="receita">+ Filtros</button>
              <div class="filter-menu" data-filter-menu-panel="receita">
                <button type="button" data-filter-key="periodo">Data</button>
                <button type="button" data-filter-key="categoria">Categoria</button>
                <button type="button" data-filter-key="valor">Valor</button>
              </div>
            </div>
            <button class="btn-tertiary history-clear" type="button" id="receita-filter-clear">Limpar</button>
          </div>
        </div>

        <div class="filter-extra-row" data-filter-row="receita">
          <div class="filter-extra" data-filter-key="periodo">
            <label class="field">
              <span class="field-label">Periodo inicio</span>
              <input type="date" id="receita-filter-start" class="control">
            </label>
            <label class="field">
              <span class="field-label">Periodo fim</span>
              <input type="date" id="receita-filter-end" class="control">
            </label>
          </div>
          <label class="field filter-extra" data-filter-key="categoria">
            <span class="field-label">Categoria</span>
            <select id="receita-filter-category" class="control">
              <option value="all">Todas</option>
              <option value="salario">Salário</option>
              <option value="extras">Extras</option>
              <option value="outros">Outros</option>
            </select>
          </label>
          <div class="filter-extra" data-filter-key="valor">
            <label class="field">
              <span class="field-label">Valor minimo</span>
              <input type="number" step="0.01" id="receita-filter-min" class="control" placeholder="R$ 0,00">
            </label>
            <label class="field">
              <span class="field-label">Valor maximo</span>
              <input type="number" step="0.01" id="receita-filter-max" class="control" placeholder="R$ 0,00">
            </label>
          </div>
        </div>

        <div class="history-summary" id="receita-summary">Total no per?odo selecionado: R$ 0,00</div>

        <div class="lista-header lista-header-receitas">
          <span class="col-data">Data</span>
          <span class="col-desc">Descrição</span>
          <span class="col-cat">Categoria</span>
          <span class="col-valor">Valor</span>
          <span class="col-acao">Ações</span>
        </div>
        <div id="receitas" class="lista lista-receitas"></div>
      </div>

      <div class="panel panel-historico panel-despesas">
        <div class="panel-head compact row">
          <h2 class="panel-title">Despesas</h2>
          <div class="panel-actions">
            <label class="field field-inline">
              <span class="field-label">Trimestre</span>
              <select id="filtro-trimestre-despesas" class="control" aria-label="Filtrar despesas por trimestre">
                <option value="all">Todos</option>
                <option value="1">1º Trimestre</option>
                <option value="2">2º Trimestre</option>
                <option value="3">3º Trimestre</option>
                <option value="4">4º Trimestre</option>
              </select>
            </label>
          </div>
        </div>

        <div class="history-toolbar">
          <span class="toolbar-label">Filtros:</span>
          <div class="toolbar-search">
            <input type="text" id="despesa-filter-search" class="control" placeholder="Titulo">
          </div>
          <div class="toolbar-actions">
            <div class="filter-dropdown">
              <button class="btn-tertiary filter-menu-btn" type="button" data-filter-menu="despesa">+ Filtros</button>
              <div class="filter-menu" data-filter-menu-panel="despesa">
                <button type="button" data-filter-key="periodo">Data</button>
                <button type="button" data-filter-key="status">Status</button>
                <button type="button" data-filter-key="categoria">Categoria</button>
                <button type="button" data-filter-key="valor">Valor</button>
              </div>
            </div>
            <button class="btn-tertiary history-clear" type="button" id="despesa-filter-clear">Limpar</button>
          </div>
        </div>

        <div class="filter-extra-row" data-filter-row="despesa">
          <div class="filter-extra" data-filter-key="periodo">
            <label class="field">
              <span class="field-label">Periodo inicio</span>
              <input type="date" id="despesa-filter-start" class="control">
            </label>
            <label class="field">
              <span class="field-label">Periodo fim</span>
              <input type="date" id="despesa-filter-end" class="control">
            </label>
          </div>
          <label class="field filter-extra" data-filter-key="status">
            <span class="field-label">Status</span>
            <select id="despesa-filter-status" class="control">
              <option value="all">Todos</option>
              <option value="pago">Pago</option>
              <option value="em_andamento">Em andamento</option>
              <option value="nao_pago">Não pago</option>
            </select>
          </label>
          <label class="field filter-extra" data-filter-key="categoria">
            <span class="field-label">Categoria</span>
            <select id="despesa-filter-category" class="control">
              <option value="all">Todas</option>
              <option value="moradia">Moradia</option>
              <option value="mercado">Mercado</option>
              <option value="transporte">Transporte</option>
              <option value="servicos">Serviços</option>
              <option value="outros">Outros</option>
            </select>
          </label>
          <div class="filter-extra" data-filter-key="valor">
            <label class="field">
              <span class="field-label">Valor minimo</span>
              <input type="number" step="0.01" id="despesa-filter-min" class="control" placeholder="R$ 0,00">
            </label>
            <label class="field">
              <span class="field-label">Valor maximo</span>
              <input type="number" step="0.01" id="despesa-filter-max" class="control" placeholder="R$ 0,00">
            </label>
          </div>
        </div>

        <div class="history-summary" id="despesa-summary">Total no per?odo selecionado: R$ 0,00</div>

        <div class="lista-header lista-header-despesas">
          <span class="col-data">Data</span>
          <span class="col-desc">Descrição</span>
          <span class="col-cat">Categoria</span>
          <span class="col-valor">Valor</span>
          <span class="col-status">Status</span>
          <span class="col-acao">Ações</span>
        </div>
        <div id="despesas" class="lista lista-despesas"></div>
      </div>
    </section>

    <!-- MODAL EDITAR -->
    <div id="modal-overlay" class="modal-overlay hidden">
      <div class="modal">
        <div class="modal-header">
          <h3>Editar Entrada</h3>
          <button id="modal-close" class="modal-close" type="button" aria-label="Fechar">×</button>
        </div>

        <form id="form-edit" class="modal-body">
          <label class="field">
            <span class="field-label">Data</span>
            <input type="date" id="edit-data" class="control" required>
          </label>

          <label class="field">
            <span class="field-label">Tipo</span>
            <select id="edit-tipo" class="control">
              <option value="receita">Receita</option>
              <option value="despesa">Despesa</option>
            </select>
          </label>

          <label class="field" id="edit-status-wrap">
            <span class="field-label">Status</span>
            <select id="edit-status" class="control">
              <option value="em_andamento">Em andamento</option>
              <option value="pago">Pago</option>
              <option value="nao_pago">Não pago</option>
            </select>
          </label>

          {% if has_feature('filters') %}
          <label class="field">
            <span class="field-label">Método</span>
            <select id="edit-metodo" class="control">
              <option value="">Não informado</option>
              <option value="dinheiro">Dinheiro</option>
              <option value="cartao">Cartão</option>
              <option value="pix">Pix</option>
            </select>
          </label>
          {% endif %}

          <label class="field">
            <span class="field-label">Categoria</span>
            <select id="edit-categoria" class="control">
              <option value="salario">Salário</option>
              <option value="extras">Extras</option>
              <option value="moradia">Moradia</option>
              <option value="mercado">Mercado</option>
              <option value="transporte">Transporte</option>
              <option value="servicos">Serviços</option>
              <option value="outros">Outros</option>
            </select>
          </label>

          <label class="field span-all">
            <span class="field-label">Descrição</span>
            <input type="text" id="edit-descricao" class="control" required>
          </label>

          <label class="field">
            <span class="field-label">Valor</span>
            <input type="number" step="0.01" id="edit-valor" class="control" required>
          </label>

          <div class="modal-actions">
            <button id="modal-cancel" type="button" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Salvar alterações</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/static/js/pages/entries.js"></script>
{% endblock %}
