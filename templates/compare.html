{% extends "base_app.html" %}
{% set page_class = 'page-compare' %}
{% set page_css = ['/static/css/app_shell.css', '/static/css/app_base.css', '/static/css/compare.css'] %}

{% block title %}Insights e variacoes | Controle Financeiro{% endblock %}
{% block page_title %}Insights{% endblock %}

{% block content %}
  <div class="page compare-page">
    <section class="panel compare-hero">
      <div class="panel-head">
        <div>
          <h2 class="panel-title">Insights e variacoes</h2>
          <p class="panel-subtitle">
            Descubra o que mudou no periodo e por que seu resultado variou.
          </p>
        </div>
        <div class="panel-actions compare-actions">
          <button class="btn-secondary" type="button" id="compare-swap">Trocar</button>
        </div>
      </div>

      <div class="compare-periods">
        <div class="compare-period" data-period="a">
          <div class="compare-period-head">
            <span class="compare-label">Periodo A</span>
            <label class="compare-toggle">
              <input type="checkbox" id="compare-range-a">
              <span>Intervalo personalizado</span>
            </label>
          </div>
          <div class="compare-selects">
            <label class="field field-inline">
              <span class="field-label">Ano</span>
              <select id="compare-year-a" class="control">
                <option value="2026">2026</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
              </select>
            </label>
            <label class="field field-inline">
              <span class="field-label">Mes</span>
              <select id="compare-month-a" class="control">
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Marco</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>
            </label>
          </div>
          <div class="compare-range">
            <label class="field field-inline">
              <span class="field-label">Inicio</span>
              <input id="compare-start-a" type="date" class="control">
            </label>
            <label class="field field-inline">
              <span class="field-label">Fim</span>
              <input id="compare-end-a" type="date" class="control">
            </label>
          </div>
        </div>

        <div class="compare-period" data-period="b">
          <div class="compare-period-head">
            <span class="compare-label">Periodo B</span>
            <label class="compare-toggle">
              <input type="checkbox" id="compare-range-b">
              <span>Intervalo personalizado</span>
            </label>
          </div>
          <div class="compare-selects">
            <label class="field field-inline">
              <span class="field-label">Ano</span>
              <select id="compare-year-b" class="control">
                <option value="2026">2026</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
              </select>
            </label>
            <label class="field field-inline">
              <span class="field-label">Mes</span>
              <select id="compare-month-b" class="control">
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Marco</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>
            </label>
          </div>
          <div class="compare-range">
            <label class="field field-inline">
              <span class="field-label">Inicio</span>
              <input id="compare-start-b" type="date" class="control">
            </label>
            <label class="field field-inline">
              <span class="field-label">Fim</span>
              <input id="compare-end-b" type="date" class="control">
            </label>
          </div>
        </div>
      </div>

      <div class="compare-error" id="compare-error" role="status" aria-live="polite" style="display:none;"></div>
    </section>

    <section class="panel compare-summary">
      <div class="compare-grid">
        <article class="compare-card">
          <h3>Receitas</h3>
          <div class="compare-values">
            <div>
              <span class="compare-value-label">Periodo A</span>
              <strong id="compare-receitas-a">R$ 0,00</strong>
            </div>
            <div>
              <span class="compare-value-label">Periodo B</span>
              <strong id="compare-receitas-b">R$ 0,00</strong>
            </div>
          </div>
          <div class="compare-delta" id="compare-receitas-delta">R$ 0,00 (0%)</div>
        </article>

        <article class="compare-card">
          <h3>Despesas</h3>
          <div class="compare-values">
            <div>
              <span class="compare-value-label">Periodo A</span>
              <strong id="compare-despesas-a">R$ 0,00</strong>
            </div>
            <div>
              <span class="compare-value-label">Periodo B</span>
              <strong id="compare-despesas-b">R$ 0,00</strong>
            </div>
          </div>
          <div class="compare-delta" id="compare-despesas-delta">R$ 0,00 (0%)</div>
        </article>

        <article class="compare-card">
          <h3>Saldo projetado</h3>
          <div class="compare-values">
            <div>
              <span class="compare-value-label">Periodo A</span>
              <strong id="compare-saldo-a">R$ 0,00</strong>
            </div>
            <div>
              <span class="compare-value-label">Periodo B</span>
              <strong id="compare-saldo-b">R$ 0,00</strong>
            </div>
          </div>
          <div class="compare-delta" id="compare-saldo-delta">R$ 0,00 (0%)</div>
        </article>

        <article class="compare-card">
          <h3>Movimentacoes</h3>
          <div class="compare-values">
            <div>
              <span class="compare-value-label">Periodo A</span>
              <strong id="compare-count-a">0 lancamentos</strong>
            </div>
            <div>
              <span class="compare-value-label">Periodo B</span>
              <strong id="compare-count-b">0 lancamentos</strong>
            </div>
          </div>
          <div class="compare-delta" id="compare-count-delta">0 (0%)</div>
        </article>
      </div>
    </section>

    <section class="panel insights-panel">
      <div class="chart-head">
        <div>
          <h3>Insights rapidos</h3>
          <p class="muted">Resumo automatico do Periodo B vs Periodo A e media 3 meses.</p>
        </div>
      </div>
      <div class="insight-grid">
        <article class="insight-card">
          <span class="insight-label">Maior aumento</span>
          <strong id="insight-top-up">--</strong>
          <span class="insight-meta" id="insight-top-up-meta">--</span>
        </article>
        <article class="insight-card">
          <span class="insight-label">Maior queda</span>
          <strong id="insight-top-down">--</strong>
          <span class="insight-meta" id="insight-top-down-meta">--</span>
        </article>
        <article class="insight-card">
          <span class="insight-label">Categoria mais pesada</span>
          <strong id="insight-top-category">--</strong>
          <span class="insight-meta" id="insight-top-category-meta">--</span>
        </article>
        <article class="insight-card">
          <span class="insight-label">Despesa vs media 3 meses</span>
          <strong id="insight-vs-avg">--</strong>
          <span class="insight-meta" id="insight-vs-avg-meta">--</span>
        </article>
      </div>
    </section>

    <section class="panel insights-explain">
      <div class="chart-head">
        <div>
          <h3>Mudanca explicada</h3>
          <p class="muted">Categorias que mais influenciaram a variacao de despesas.</p>
        </div>
      </div>
      <ul id="insight-changes" class="compare-list-items"></ul>
    </section>

    <section class="panel compare-chart">
      <div class="chart-head">
        <div>
          <h3>Comparativo por categoria</h3>
          <p class="muted">Barras lado a lado entre Periodo A e Periodo B.</p>
        </div>
        <div class="compare-chart-legend">
          <span class="legend-pill legend-a">Periodo A</span>
          <span class="legend-pill legend-b">Periodo B</span>
        </div>
      </div>
      <div id="compare-bars" class="compare-bars"></div>
    </section>

    <section class="panel compare-categories">
      <div class="compare-lists">
        <div class="compare-list">
          <h3>Top categorias - Periodo A</h3>
          <ul id="compare-categories-a" class="compare-list-items"></ul>
        </div>
        <div class="compare-list">
          <h3>Top categorias - Periodo B</h3>
          <ul id="compare-categories-b" class="compare-list-items"></ul>
        </div>
      </div>
    </section>

    <section class="panel insights-top">
      <div class="compare-lists">
        <div class="compare-list">
          <h3>Maiores entradas - Periodo B</h3>
          <ul id="insight-top-income" class="compare-list-items"></ul>
        </div>
        <div class="compare-list">
          <h3>Maiores saidas - Periodo B</h3>
          <ul id="insight-top-expense" class="compare-list-items"></ul>
        </div>
      </div>
    </section>
  </div>

  <script src="/static/js/pages/compare.js"></script>
{% endblock %}
