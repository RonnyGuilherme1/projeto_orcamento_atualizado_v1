{% extends "base_public.html" %}
{% set page_class = 'page-verify' %}
{% set page_css = ['/static/css/verify_pending.css'] %}

{% block title %}Confirme seu e-mail | LinkGestor{% endblock %}

{% block headline %}Confirme seu e-mail{% endblock %}

{% block subhead %}
  <p class="public-subtitle">
    Para concluir o cadastro, precisamos validar seu endereço de e-mail.
  </p>
{% endblock %}

{% block content %}
  <div class="verify-panel">
    <div class="verify-top">
      <div class="verify-orb" aria-hidden="true"></div>
      <div>
        <p class="verify-title">Verificação pendente</p>
        <p class="verify-subtitle">Enviamos um link para confirmar seu cadastro.</p>
      </div>
    </div>

    <div class="verify-email">
      <span>E-mail enviado para</span>
      <strong>{{ current_user.email }}</strong>
    </div>

    <ul class="verify-steps">
      <li>Abra sua caixa de entrada e clique no link de confirmação.</li>
      <li>Se não encontrar, verifique as abas de spam ou promoções.</li>
      <li>Precisa reenviar? Use o botão abaixo.</li>
    </ul>

    <form method="post" action="/resend-verification" class="verify-actions">
      <button class="btn-primary" type="submit">Reenviar e-mail de verificação</button>
      <span class="verify-hint">Se tiver acabado de solicitar, aguarde alguns minutos.</span>
    </form>

    {% if dev_verify_link %}
      <div class="verify-dev" role="note">
        <div class="verify-dev-head">
          <span class="verify-dev-title">Link de verificação (DEV)</span>
          <span class="verify-dev-note">Apenas para testes</span>
        </div>
        <div class="verify-dev-actions">
          <a class="verify-dev-link" href="{{ dev_verify_link }}" target="_blank" rel="noopener">
            {{ dev_verify_link }}
          </a>
          <button class="btn-secondary btn-copy" type="button" data-copy="{{ dev_verify_link }}">
            Copiar link
          </button>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="public-actions verify-footer-actions">
    <a class="btn-secondary" href="/logout">Sair</a>
    <a class="btn-link" href="/login">Voltar ao login</a>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  {% if dev_verify_link %}
    <script>
      (() => {
        const btn = document.querySelector(".btn-copy[data-copy]");
        if (!btn) return;
        const originalText = btn.textContent;
        btn.addEventListener("click", async () => {
          const link = btn.getAttribute("data-copy") || "";
          if (!link) return;
          try {
            if (navigator.clipboard?.writeText) {
              await navigator.clipboard.writeText(link);
            } else {
              const temp = document.createElement("input");
              temp.value = link;
              document.body.appendChild(temp);
              temp.select();
              document.execCommand("copy");
              temp.remove();
            }
            btn.textContent = "Copiado!";
            setTimeout(() => {
              btn.textContent = originalText;
            }, 1400);
          } catch (err) {
            btn.textContent = "Falhou";
            setTimeout(() => {
              btn.textContent = originalText;
            }, 1400);
          }
        });
      })();
    </script>
  {% endif %}
{% endblock %}
