{% extends "base_app.html" %}
{% set page_class = 'page-charts' %}
{% set page_css = ['/static/css/app_shell.css', '/static/css/app_base.css', '/static/css/charts.css'] %}

{% block title %}Gráficos | Controle Financeiro{% endblock %}
{% block page_title %}Gráficos{% endblock %}

{% block content %}
  <div class="page charts-page">
    <section class="panel charts-hero">
      <div class="panel-head">
        <div>
          <h2 class="panel-title">Gráficos</h2>
          <p class="panel-subtitle">Acompanhe o comportamento financeiro do período e descubra onde ajustar seu orçamento.</p>
        </div>
        <div class="panel-actions">
          <label class="field field-inline">
            <span class="field-label">Ano</span>
            <select id="chart-year" class="control">
              <option value="2026">2026</option>
              <option value="2025">2025</option>
              <option value="2024">2024</option>
            </select>
          </label>
          <label class="field field-inline">
            <span class="field-label">Mês</span>
            <select id="chart-month" class="control">
              <option value="1">Janeiro</option>
              <option value="2">Fevereiro</option>
              <option value="3">Março</option>
              <option value="4">Abril</option>
              <option value="5">Maio</option>
              <option value="6">Junho</option>
              <option value="7">Julho</option>
              <option value="8">Agosto</option>
              <option value="9">Setembro</option>
              <option value="10">Outubro</option>
              <option value="11">Novembro</option>
              <option value="12">Dezembro</option>
            </select>
          </label>
          <button class="btn btn-ghost" type="button">Exportar</button>
        </div>
      </div>

      <div class="hero-grid">
        <div class="hero-stat">
          <span class="stat-label">Receitas no período</span>
          <strong id="summary-receitas">R$ 0,00</strong>
          <span class="stat-meta" id="summary-receitas-meta">Total do período</span>
        </div>
        <div class="hero-stat">
          <span class="stat-label">Despesas no período</span>
          <strong id="summary-despesas">R$ 0,00</strong>
          <span class="stat-meta" id="summary-despesas-meta">Total do período</span>
        </div>
        <div class="hero-stat">
          <span class="stat-label">Saldo do período</span>
          <strong id="summary-saldo">R$ 0,00</strong>
          <span class="stat-meta" id="summary-saldo-meta">Receitas - despesas</span>
        </div>
        <div class="hero-stat">
          <span class="stat-label">Entradas registradas</span>
          <strong id="summary-count">0 lançamentos</strong>
          <span class="stat-meta" id="summary-count-meta">0 receitas · 0 despesas</span>
        </div>
      </div>

      <div class="hero-notes">
        <span class="note-pill" id="chart-note-updated">Atualizado agora</span>
        <span class="note-pill" id="chart-note-balance">Saldo anterior: R$ 0,00</span>
      </div>
    </section>

    <section class="charts-grid">
      <article class="panel chart-card span-2">
        <div class="chart-head">
          <div>
            <h3>Fluxo do mês</h3>
            <p>Receitas x despesas com saldo acumulado</p>
          </div>
          <div class="chart-legend">
            <span class="legend-item legend-income"><span class="legend-dot"></span>Receitas</span>
            <span class="legend-item legend-expense"><span class="legend-dot"></span>Despesas</span>
            <span class="legend-item legend-balance"><span class="legend-dot"></span>Saldo</span>
          </div>
        </div>

        <div class="chart-canvas chart-line">
          <svg class="chart-svg" viewBox="0 0 640 220" preserveAspectRatio="none" aria-hidden="true">
            <defs>
              <linearGradient id="incomeFill" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="rgba(76, 175, 80, 0.38)" />
                <stop offset="100%" stop-color="rgba(76, 175, 80, 0.02)" />
              </linearGradient>
              <linearGradient id="expenseFill" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="rgba(245, 166, 35, 0.32)" />
                <stop offset="100%" stop-color="rgba(245, 166, 35, 0.02)" />
              </linearGradient>
            </defs>
            <path class="area-income" data-area="income" d="M0 180 L640 180 L640 220 L0 220 Z" />
            <path class="area-expense" data-area="expense" d="M0 190 L640 190 L640 220 L0 220 Z" />
            <path class="line-income" data-line="income" d="M0 180 L640 180" />
            <path class="line-expense" data-line="expense" d="M0 190 L640 190" />
            <path class="line-balance" data-line="balance" d="M0 170 L640 170" />
            <circle class="line-point" data-point="income" cx="0" cy="180" r="4" />
            <circle class="line-point" data-point="expense" cx="0" cy="190" r="4" />
            <circle class="line-point alt" data-point="balance" cx="0" cy="170" r="4" />
          </svg>
          <div class="chart-guide" id="line-guide" aria-hidden="true"></div>
          <div class="chart-tooltip" id="line-tooltip" aria-hidden="true">
            <span class="tooltip-type" id="line-tooltip-type">Receita</span>
            <strong class="tooltip-value" id="line-tooltip-value">R$ 0,00</strong>
            <span class="tooltip-date" id="line-tooltip-date">00/00/0000</span>
          </div>
          <div class="chart-empty">Sem dados no período</div>
        </div>

        <div class="chart-footer">
          <div class="chart-kpi">
            <span class="kpi-label">Melhor semana</span>
            <strong id="kpi-best-week">R$ 0,00</strong>
            <span class="kpi-meta" id="kpi-best-week-label">-</span>
          </div>
          <div class="chart-kpi">
            <span class="kpi-label">Maior saída</span>
            <strong id="kpi-top-expense">R$ 0,00</strong>
            <span class="kpi-meta" id="kpi-top-expense-label">-</span>
          </div>
          <div class="chart-kpi">
            <span class="kpi-label">Equilíbrio</span>
            <strong id="kpi-balance">0%</strong>
            <span class="kpi-meta" id="kpi-balance-label">Receitas x despesas</span>
          </div>
        </div>
      </article>

      <article class="panel chart-card">
        <div class="chart-head">
          <div>
            <h3>Despesas por categoria</h3>
            <p>Top 5 do período</p>
          </div>
        </div>
        <div class="chart-canvas donut-wrap">
          <div class="donut" id="chart-donut" role="img" aria-label="Distribuição de despesas por categoria">
            <div class="donut-center">
              <span class="donut-value" id="donut-total">R$ 0,00</span>
              <span class="donut-label" id="donut-label">Total de despesas</span>
            </div>
          </div>
          <ul class="donut-legend" id="donut-legend"></ul>
          <div class="chart-empty">Sem despesas no período</div>
        </div>
      </article>

      <article class="panel chart-card">
        <div class="chart-head">
          <div>
            <h3>Status das despesas</h3>
            <p>Pagas, em andamento e não pagas</p>
          </div>
        </div>
        <div class="chart-canvas bars" id="status-bars">
          <div class="bar-row" data-status="pago">
            <span class="bar-label">Pagas</span>
            <div class="bar-track">
              <div class="bar-fill bar-paid" data-bar="pago" style="width: 0%"></div>
            </div>
            <span class="bar-value" data-bar-value="pago">R$ 0,00</span>
          </div>
          <div class="bar-row" data-status="em_andamento">
            <span class="bar-label">Em andamento</span>
            <div class="bar-track">
              <div class="bar-fill bar-open" data-bar="em_andamento" style="width: 0%"></div>
            </div>
            <span class="bar-value" data-bar-value="em_andamento">R$ 0,00</span>
          </div>
          <div class="bar-row" data-status="nao_pago">
            <span class="bar-label">Não pagas</span>
            <div class="bar-track">
              <div class="bar-fill bar-late" data-bar="nao_pago" style="width: 0%"></div>
            </div>
            <span class="bar-value" data-bar-value="nao_pago">R$ 0,00</span>
          </div>
          <div class="chart-empty">Sem despesas no período</div>
        </div>
      </article>

      <article class="panel chart-card">
        <div class="chart-head">
          <div>
            <h3>Categorias</h3>
            <p>Distribuição por tipo</p>
          </div>
        </div>
        <div class="chart-canvas bars" id="categories-bars">
          <div class="chart-empty">Sem despesas no período</div>
        </div>
      </article>

      <article class="panel chart-card goals-card">
        <div class="chart-head">
          <div>
            <h3>Metas</h3>
            <p>Defina sua meta de economia</p>
          </div>
        </div>
        <div class="goal-controls">
          <label class="field field-inline">
            <span class="field-label">Período</span>
            <select id="goal-period" class="control">
              <option value="monthly">Mensal</option>
              <option value="biweekly">Quinzenal</option>
              <option value="weekly">Semanal</option>
            </select>
          </label>
          <label class="field field-inline">
            <span class="field-label">Meta personalizada</span>
            <input id="goal-custom" class="control" type="text" inputmode="decimal" placeholder="R$ 0,00" />
          </label>
        </div>
        <div class="progress">
          <div class="progress-head">
            <span>Meta de economia</span>
            <span id="goal-savings-label">R$ 0,00 / R$ 0,00</span>
          </div>
          <div class="progress-track">
            <div class="progress-fill" id="goal-savings-bar" style="width: 0%"></div>
          </div>
          <p class="insight-muted" id="goal-savings-meta">Sem dados para estimar a meta.</p>
        </div>
      </article>
    </section>

    <section class="insights-grid">
      <article class="panel insight-card span-3">
        <h3>Alertas do mês</h3>
        <ul class="insight-list" id="chart-alerts"></ul>
      </article>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/static/js/pages/charts.js"></script>
{% endblock %}
